<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Console</title>
    <style>
        /* ===========================
           CONFIG - Customization Section
           Inspired by Yeezy.com minimalist aesthetic
           =========================== */
        :root {
            /* Light Mode Palette */
            --bg-primary: #ffffff;
            --bg-secondary: #ffffff;
            --bg-tertiary: #ffffff;
            --text-primary: #000000;
            --text-secondary: #6e6e6e;
            --text-tertiary: #a0a0a0;
            --border-color: #e5e5e5;
            --accent: #000000;
            --hover-bg: rgba(0, 0, 0, 0.04);
            
            /* Shadows - minimal and precise */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
            --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.6);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.7);
            
            /* Spacing - 8px system from Yeezy */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            
            /* Typography - clean system fonts */
            --font-system: ui-monospace, 'SF Mono', 'Consolas', 'Monaco', monospace;
            --font-display: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        /* Dark Mode */
        body.dark-mode {
            --bg-primary: #000000;
            --bg-secondary: #000000;
            --bg-tertiary: #000000;
            --text-primary: #ffffff;
            --text-secondary: #6e6e6e;
            --text-tertiary: #4a4a4a;
            --border-color: #1a1a1a;
            --accent: #ffffff;
            --hover-bg: rgba(255, 255, 255, 0.04);
        }

        body.dark-mode .album-placeholder {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
        }

        /* ===========================
           Base Styles
           =========================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-display);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            letter-spacing: -0.01em;
        }

        /* ===========================
           Main Container - Full Width Landscape
           =========================== */
        .console {
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-columns: 400px 1fr;
            grid-template-rows: 1fr;
            background: var(--bg-primary);
        }

        /* ===========================
           Left Panel - Album Art & Info
           =========================== */
        .left-panel {
            grid-column: 1;
            grid-row: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            overflow-y: auto;
            justify-content: center;
        }

        .header {
            padding: var(--space-xl);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-lg);
        }

        .album-art-container {
            width: 100%;
            aspect-ratio: 1;
            max-width: 320px;
            background: var(--bg-tertiary);
            border-radius: 0;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            position: relative;
        }

        .album-art {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .album-art.visible {
            display: block;
        }

        .album-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f5f5 0%, #fafafa 100%);
        }

        .album-placeholder svg {
            width: 80px;
            height: 80px;
            opacity: 0.2;
        }

        .track-info {
            text-align: center;
            width: 100%;
            padding: 0 var(--space-lg);
        }

        .track-title {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 8px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-family: var(--font-system);
        }

        .track-artist {
            font-size: 14px;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
            text-transform: uppercase;
            font-family: var(--font-system);
            margin-bottom: var(--space-md);
        }

        .album-metadata {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: var(--space-md);
            padding-top: var(--space-md);
        }

        .metadata-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            font-family: var(--font-system);
            letter-spacing: 0.05em;
        }

        .metadata-label {
            color: var(--text-tertiary);
            text-transform: uppercase;
        }

        .metadata-value {
            color: var(--text-secondary);
            text-align: right;
        }

        /* ===========================
           Right Panel - Tracklist
           =========================== */
        .right-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-top: 1px solid var(--border-color);
        }

        /* Tracklist toggle button */
        .tracklist-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: var(--space-md) var(--space-xl);
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: var(--font-system);
            font-size: 11px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: color 0.2s ease;
        }

        .tracklist-toggle:hover {
            color: var(--text-primary);
        }

        .tracklist-toggle-left {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .tracklist-toggle-icon {
            width: 14px;
            height: 14px;
            opacity: 0.5;
        }

        .tracklist-toggle-arrow {
            font-size: 12px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-block;
        }

        .tracklist-toggle.open .tracklist-toggle-arrow {
            transform: rotate(180deg);
        }

        .tracklist-toggle-count {
            font-size: 10px;
            color: var(--text-tertiary);
            font-family: var(--font-system);
        }

        /* Collapsible body */
        .tracklist-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.45s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tracklist-body.open {
            max-height: 600px;
            overflow-y: auto;
        }

        .tracklist-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-xs) 0;
        }

        .tracklist {
            list-style: none;
        }

        .track-item {
            padding: 8px var(--space-xl);
            display: grid;
            grid-template-columns: 48px 1fr auto;
            gap: 16px;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
        }

        .track-item:hover {
            background: var(--hover-bg);
            border-left-color: var(--text-tertiary);
        }

        .track-item.active {
            background: transparent;
            border-left-color: var(--accent);
        }

        .track-number {
            font-size: 12px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
            text-align: right;
            font-family: var(--font-system);
            letter-spacing: 0.05em;
            position: relative;
        }

        /* Track number stays visible - removed the hiding rule */

        /* Waveform icon – shows alongside number on active track */
        .track-eq {
            display: none;
            align-items: flex-end;
            justify-content: center;
            gap: 1.5px;
            width: 22px;
            height: 18px;
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        .track-item.active .track-eq {
            display: flex;
        }

        .track-eq span {
            display: block;
            width: 2px;
            background: var(--accent);
            border-radius: 1px;
            transform-origin: bottom;
            animation: waveform 1.2s ease-in-out infinite;
        }

        .track-eq span:nth-child(1) { height: 8px;  animation-delay: 0s;     }
        .track-eq span:nth-child(2) { height: 14px; animation-delay: 0.1s;    }
        .track-eq span:nth-child(3) { height: 18px; animation-delay: 0.25s;   }
        .track-eq span:nth-child(4) { height: 12px; animation-delay: 0.15s;   }
        .track-eq span:nth-child(5) { height: 7px;  animation-delay: 0.35s;   }

        @keyframes waveform {
            0%, 100% { transform: scaleY(0.3); }
            40%      { transform: scaleY(1);   }
            60%      { transform: scaleY(0.6); }
        }

        .track-details {
            min-width: 0;
        }

        .track-name {
            font-size: 14px;
            font-weight: 400;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }

        .track-artist-name {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            font-family: var(--font-system);
        }

        .track-duration {
            font-size: 12px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
            font-family: var(--font-system);
        }

        /* ===========================
           Bottom Controls Section
           =========================== */
        .controls-section {
            grid-column: 2;
            grid-row: 1;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Ambient bar – removed */

        /* Top info strip – removed */

        /* Core controls – grow to fill remaining space, centre vertically */
        .controls-core {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: var(--space-md);
            padding: 0 var(--space-xl);
        }

        /* History row – removed */

        .now-playing {
            font-size: 18px;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: var(--space-xs);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-family: var(--font-system);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 0 8px rgba(0,0,0,0.25), 0 0 20px rgba(0,0,0,0.12);
            font-weight: 300;
        }

        body.dark-mode .now-playing {
            text-shadow: 0 0 8px rgba(255,255,255,0.7), 0 0 20px rgba(255,255,255,0.35);
        }

        .next-up {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 2px;
            margin-bottom: var(--space-sm);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .next-up.visible {
            opacity: 1;
        }

        .next-up-label {
            font-size: 9px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-family: var(--font-system);
        }

        .next-up-arrow {
            color: var(--text-tertiary);
            font-size: 10px;
            line-height: 1;
        }

        .next-up-title {
            font-size: 11px;
            color: var(--text-secondary);
            font-family: var(--font-system);
            letter-spacing: 0.03em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 600px;
        }

        .progress-section {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            cursor: pointer;
            position: relative;
            overflow: visible;
        }

        body.dark-mode .progress-bar {
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--text-secondary);
            position: relative;
            width: 0;
        }

        .progress-thumb {
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress-thumb {
            opacity: 1;
        }

        .progress-fill:hover {
            background: var(--text-primary);
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
            font-family: var(--font-system);
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-md);
        }

        .control-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            border-radius: 0;
        }

        .control-btn:hover {
            color: var(--text-primary);
            background: transparent;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        /* Fixed active state for shuffle/loop buttons */
        .control-btn.active {
            color: #000000;
            background: transparent;
            filter: drop-shadow(0 0 6px rgba(0,0,0,0.85)) drop-shadow(0 0 14px rgba(0,0,0,0.45));
        }

        body.dark-mode .control-btn.active {
            color: #ffffff;
            background: transparent;
            filter: drop-shadow(0 0 6px rgba(255,255,255,0.85)) drop-shadow(0 0 14px rgba(255,255,255,0.45));
        }

        .control-btn svg {
            width: 22px;
            height: 22px;
        }

        .play-btn {
            width: 64px;
            height: 64px;
            background: transparent;
        }

        .play-btn:hover {
            background: transparent;
        }

        .play-btn svg {
            width: 28px;
            height: 28px;
        }

        .secondary-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-md);
            margin-top: var(--space-xs);
        }

        .left-controls,
        .right-controls {
            display: flex;
            gap: var(--space-md);
            align-items: center;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .volume-slider-track {
            width: 100px;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            position: relative;
            cursor: pointer;
            border-radius: 0;
        }

        body.dark-mode .volume-slider-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .volume-slider-fill {
            height: 100%;
            background: var(--text-secondary);
            position: absolute;
            left: 0;
            top: 0;
            width: 70%;
        }

        .volume-slider-thumb {
            position: absolute;
            top: 50%;
            left: 70%;
            width: 12px;
            height: 12px;
            background: var(--text-primary);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            z-index: 2;
        }

        .volume-slider-thumb:active {
            cursor: grabbing;
        }

        .file-upload-container {
            position: relative;
        }

        .file-upload-label {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: var(--font-system);
        }

        .file-upload-label:hover {
            background: transparent;
            color: var(--text-primary);
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        .file-upload-label svg {
            width: 14px;
            height: 14px;
        }

        #fileInput {
            display: none;
        }

        .theme-toggle {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: var(--space-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            color: var(--text-primary);
            background: var(--hover-bg);
        }

        .theme-toggle svg {
            width: 18px;
            height: 18px;
        }

        /* Scrollbar styling */
        .tracklist-container::-webkit-scrollbar {
            width: 8px;
        }

        .tracklist-container::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        .tracklist-container::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 0;
        }

        .tracklist-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .console {
                grid-template-columns: 320px 1fr;
            }
            
            .album-art-container {
                max-width: 260px;
            }
        }

        @media (max-width: 768px) {
            .console {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .left-panel {
                grid-column: 1;
                grid-row: 1;
                max-height: 50vh;
            }
            
            .header {
                padding: var(--space-lg);
            }
            
            .album-art-container {
                max-width: 200px;
            }
            
            .controls-section {
                grid-column: 1;
                grid-row: 2;
            }
        }
    </style>
</head>
<body>
    <div class="console">
        <!-- Left Panel: Album Art & Info -->
        <div class="left-panel">
            <div class="header">
                <div class="album-art-container">
                    <img id="albumArt" class="album-art" alt="Album Art">
                    <div class="album-placeholder">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                        </svg>
                    </div>
                </div>
                <div class="track-info">
                    <div class="track-title" id="currentTitle">No Album</div>
                    <div class="track-artist" id="currentArtist">Unknown Artist</div>
                    
                    <div class="album-metadata" id="albumMetadata" style="display: none;">
                        <div class="metadata-row">
                            <span class="metadata-label">Genre</span>
                            <span class="metadata-value" id="albumGenre">—</span>
                        </div>
                        <div class="metadata-row">
                            <span class="metadata-label">Duration</span>
                            <span class="metadata-value" id="albumDuration">—</span>
                        </div>
                        <div class="metadata-row">
                            <span class="metadata-label">Tracks</span>
                            <span class="metadata-value" id="albumTrackCount">—</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tracklist nested below metadata -->
            <div class="right-panel">
                <button class="tracklist-toggle" id="tracklistToggle">
                    <div class="tracklist-toggle-left">
                        <svg class="tracklist-toggle-icon" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                        Tracklist
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;">
                        <span class="tracklist-toggle-count" id="tracklistCount"></span>
                        <span class="tracklist-toggle-arrow">▼</span>
                    </div>
                </button>
                <div class="tracklist-body" id="tracklistBody">
                    <div class="tracklist-container">
                        <ul class="tracklist" id="tracklist"></ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Playback Controls (right side, full height) -->
        <div class="controls-section">
            <!-- Core: now-playing, next-up, progress, buttons, secondary -->
            <div class="controls-core">
                <div class="now-playing" id="nowPlaying">Select a track to play</div>
                <div class="next-up" id="nextUp">
                    <span class="next-up-label">Next</span>
                    <span class="next-up-arrow">›</span>
                    <span class="next-up-title" id="nextUpTitle">—</span>
                </div>

                <div class="progress-section">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill">
                            <div class="progress-thumb"></div>
                        </div>
                    </div>
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>

                <div class="controls">
                    <button class="control-btn" id="shuffleBtn" title="Shuffle (S)">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
                    </button>
                    <button class="control-btn" id="prevBtn" title="Previous (←)">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                    </button>
                    <button class="control-btn play-btn" id="playBtn" title="Play/Pause (Space)">
                        <svg id="playIcon" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        <svg id="pauseIcon" fill="currentColor" viewBox="0 0 24 24" style="display:none;"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/></svg>
                    </button>
                    <button class="control-btn" id="nextBtn" title="Next (→)">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg>
                    </button>
                    <button class="control-btn" id="loopBtn" title="Loop (L)">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
                    </button>
                </div>

                <div class="secondary-controls">
                    <div class="left-controls">
                        <div class="file-upload-container">
                            <label class="file-upload-label" for="fileInput">
                                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg>
                                Add Music
                            </label>
                            <input type="file" id="fileInput" accept="audio/*" multiple>
                        </div>
                        <button class="control-btn" id="themeToggle" title="Toggle Dark/Light Mode">
                            <svg id="lightIcon" fill="currentColor" viewBox="0 0 24 24"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
                            <svg id="darkIcon" fill="currentColor" viewBox="0 0 24 24" style="display:none;"><path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.06 7 9.54 0 4.48-2.94 8.27-7 9.54.95.3 1.95.46 3 .46 5.52 0 10-4.48 10-10S14.52 2 9 2z"/></svg>
                        </button>
                    </div>
                    <div class="right-controls">
                        <div class="volume-control">
                            <button class="control-btn" id="volumeBtn">
                                <svg id="volumeIcon" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
                            </button>
                            <div class="volume-slider-track" id="volumeTrack">
                                <div class="volume-slider-fill" id="volumeFill" style="width:70%"></div>
                                <div class="volume-slider-thumb" id="volumeThumb" style="left:70%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    <script>
        class MusicPlayer {
            constructor() {
                this.audio = new Audio();
                this.tracks = [];
                this.currentTrackIndex = -1;
                this.nextTrackIndex = -1;
                this.isPlaying = false;
                this.isShuffle = false;
                this.isLoop = false;
                this.albumInfo = {};

                this.init();
            }

            init() {
                // Event listeners
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('loadedmetadata', () => this.updateDuration());
                this.audio.addEventListener('ended', () => this.handleTrackEnd());

                // Control buttons
                document.getElementById('playBtn').addEventListener('click', () => this.togglePlay());
                document.getElementById('nextBtn').addEventListener('click', () => this.playNext());
                document.getElementById('prevBtn').addEventListener('click', () => this.playPrevious());
                document.getElementById('shuffleBtn').addEventListener('click', () => this.toggleShuffle());
                document.getElementById('loopBtn').addEventListener('click', () => this.toggleLoop());

                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());

                // Progress bar with drag support
                const progressBar = document.getElementById('progressBar');
                let isDragging = false;
                
                progressBar.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    this.seek(e);
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        this.seek(e);
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
                
                progressBar.addEventListener('click', (e) => this.seek(e));

                // Volume controls – custom slider
                const volumeTrack = document.getElementById('volumeTrack');
                const volumeFill  = document.getElementById('volumeFill');
                const volumeThumb = document.getElementById('volumeThumb');
                let volDragging = false;

                const setVolume = (pct) => {
                    pct = Math.max(0, Math.min(100, pct));
                    this.audio.volume = pct / 100;
                    volumeFill.style.width  = pct + '%';
                    volumeThumb.style.left  = pct + '%';
                };

                const getVolPct = (e) => {
                    const rect = volumeTrack.getBoundingClientRect();
                    return ((e.clientX - rect.left) / rect.width) * 100;
                };

                volumeThumb.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    volDragging = true;
                });
                volumeTrack.addEventListener('mousedown', (e) => {
                    volDragging = true;
                    setVolume(getVolPct(e));
                });
                document.addEventListener('mousemove', (e) => {
                    if (volDragging) setVolume(getVolPct(e));
                });
                document.addEventListener('mouseup', () => { volDragging = false; });

                // Tracklist toggle
                const tracklistToggle = document.getElementById('tracklistToggle');
                const tracklistBody   = document.getElementById('tracklistBody');
                tracklistToggle.addEventListener('click', () => {
                    const isOpen = tracklistBody.classList.toggle('open');
                    tracklistToggle.classList.toggle('open', isOpen);
                });

                // File input
                document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileSelect(e));

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeyboard(e));

                // Load saved session
                this.loadSession();

                // Save session on changes
                window.addEventListener('beforeunload', () => this.saveSession());
            }

            async handleFileSelect(event) {
                const files = Array.from(event.target.files);
                const processedTracks = [];
                
                for (const file of files) {
                    if (file.type.startsWith('audio/')) {
                        const track = await this.extractMetadata(file);
                        processedTracks.push(track);
                    }
                }

                if (processedTracks.length > 0) {
                    // Group by album
                    const albumGroups = this.groupByAlbum(processedTracks);
                    
                    // Take the first (or most common) album
                    const albumNames = Object.keys(albumGroups);
                    const primaryAlbum = albumNames[0];
                    this.tracks = albumGroups[primaryAlbum];
                    
                    // Set album info from first track
                    const firstTrack = this.tracks[0];
                    this.albumInfo = {
                        name: firstTrack.album,
                        artist: firstTrack.artist,
                        genre: firstTrack.genre || '—',
                        year: firstTrack.year || '—',
                        art: firstTrack.albumArt
                    };

                    this.renderUI();
                    
                    // Auto-play first track
                    if (this.tracks.length > 0) {
                        this.playTrack(0);
                    }
                }

                // Clear input
                event.target.value = '';
            }

            groupByAlbum(tracks) {
                const groups = {};
                
                tracks.forEach(track => {
                    const album = track.album || 'Unknown Album';
                    if (!groups[album]) {
                        groups[album] = [];
                    }
                    groups[album].push(track);
                });
                
                // Sort tracks within each album by track number
                Object.values(groups).forEach(albumTracks => {
                    albumTracks.sort((a, b) => {
                        const trackA = parseInt(a.track) || 0;
                        const trackB = parseInt(b.track) || 0;
                        return trackA - trackB;
                    });
                });
                
                return groups;
            }

            async extractMetadata(file) {
                return new Promise((resolve) => {
                    new jsmediatags.Reader(file)
                        .setTagsToRead(['title', 'artist', 'album', 'track', 'year', 'genre', 'picture'])
                        .read({
                            onSuccess: (tag) => {
                                const tags = tag.tags;
                                let albumArt = null;

                                if (tags.picture) {
                                    const { data, format } = tags.picture;
                                    const byteArray = new Uint8Array(data);
                                    const blob = new Blob([byteArray], { type: format });
                                    albumArt = URL.createObjectURL(blob);
                                }

                                resolve({
                                    file: file,
                                    url: URL.createObjectURL(file),
                                    title: tags.title || file.name,
                                    artist: tags.artist || 'Unknown Artist',
                                    album: tags.album || 'Unknown Album',
                                    track: tags.track || '',
                                    year: tags.year || '',
                                    genre: tags.genre || '',
                                    albumArt: albumArt,
                                    duration: 0
                                });
                            },
                            onError: () => {
                                resolve({
                                    file: file,
                                    url: URL.createObjectURL(file),
                                    title: file.name,
                                    artist: 'Unknown Artist',
                                    album: 'Unknown Album',
                                    track: '',
                                    year: '',
                                    genre: '',
                                    albumArt: null,
                                    duration: 0
                                });
                            }
                        });
                });
            }

            renderUI() {
                this.renderAlbumInfo();
                this.renderTracklist();
            }

            renderAlbumInfo() {
                const albumArt = document.getElementById('albumArt');
                const currentTitle = document.getElementById('currentTitle');
                const currentArtist = document.getElementById('currentArtist');
                const albumMetadata = document.getElementById('albumMetadata');
                const albumGenre = document.getElementById('albumGenre');
                const albumTrackCount = document.getElementById('albumTrackCount');

                currentTitle.textContent = this.albumInfo.name;
                currentArtist.textContent = this.albumInfo.artist;

                if (this.albumInfo.art) {
                    albumArt.src = this.albumInfo.art;
                    albumArt.classList.add('visible');
                } else {
                    albumArt.classList.remove('visible');
                }

                // Show metadata
                albumMetadata.style.display = 'flex';
                albumGenre.textContent = this.albumInfo.genre;
                albumTrackCount.textContent = `${this.tracks.length} tracks`;

                // Calculate total duration
                const totalSeconds = this.tracks.reduce((sum, track) => sum + (track.duration || 0), 0);
                document.getElementById('albumDuration').textContent = this.formatDuration(totalSeconds);
            }

            renderTracklist() {
                const tracklist = document.getElementById('tracklist');
                const tracklistCount = document.getElementById('tracklistCount');
                
                tracklist.innerHTML = '';
                tracklistCount.textContent = `${this.tracks.length} TRACKS`;

                this.tracks.forEach((track, index) => {
                    const li = document.createElement('li');
                    li.className = 'track-item';
                    li.innerHTML = `
                        <div class="track-number">
                            ${String(index + 1).padStart(2, '0')}
                            <div class="track-eq">
                                <span></span><span></span><span></span><span></span><span></span>
                            </div>
                        </div>
                        <div class="track-details">
                            <div class="track-name">${track.title}</div>
                            <div class="track-artist-name">${track.artist}</div>
                        </div>
                        <div class="track-duration">${this.formatTime(track.duration)}</div>
                    `;
                    
                    li.addEventListener('click', () => this.playTrack(index));
                    tracklist.appendChild(li);
                });

                // Load durations asynchronously
                this.loadTrackDurations();
            }

            async loadTrackDurations() {
                for (let i = 0; i < this.tracks.length; i++) {
                    const track = this.tracks[i];
                    if (track.duration === 0) {
                        const audio = new Audio(track.url);
                        await new Promise((resolve) => {
                            audio.addEventListener('loadedmetadata', () => {
                                track.duration = audio.duration;
                                
                                // Update UI
                                const trackItems = document.querySelectorAll('.track-item');
                                if (trackItems[i]) {
                                    const durationEl = trackItems[i].querySelector('.track-duration');
                                    durationEl.textContent = this.formatTime(track.duration);
                                }
                                
                                // Update total duration
                                const totalSeconds = this.tracks.reduce((sum, t) => sum + (t.duration || 0), 0);
                                document.getElementById('albumDuration').textContent = this.formatDuration(totalSeconds);
                                
                                resolve();
                            });
                        });
                    }
                }
            }

            playTrack(index) {
                if (index < 0 || index >= this.tracks.length) return;

                this.currentTrackIndex = index;
                const track = this.tracks[index];

                this.audio.src = track.url;
                this.audio.play();
                this.isPlaying = true;

                // Update now playing
                document.getElementById('nowPlaying').textContent = track.title;

                // Update active track in list
                this.updateActiveTrack();

                // Update play button
                this.updatePlayButton();

                // Update next up
                this.updateNextUp();
            }

            updateNextUp() {
                const nextUp = document.getElementById('nextUp');
                const nextUpTitle = document.getElementById('nextUpTitle');

                if (this.tracks.length > 1) {
                    if (this.isShuffle) {
                        // Generate random index different from current
                        do {
                            this.nextTrackIndex = Math.floor(Math.random() * this.tracks.length);
                        } while (this.nextTrackIndex === this.currentTrackIndex && this.tracks.length > 1);
                    } else {
                        this.nextTrackIndex = (this.currentTrackIndex + 1) % this.tracks.length;
                    }
                    nextUpTitle.textContent = this.tracks[this.nextTrackIndex].title;
                    nextUp.classList.add('visible');
                } else {
                    nextUp.classList.remove('visible');
                }
            }

            updateActiveTrack() {
                const items = document.querySelectorAll('.track-item');
                items.forEach((item, index) => {
                    item.classList.toggle('active', index === this.currentTrackIndex);
                });
            }

            togglePlay() {
                if (this.tracks.length === 0) return;

                if (this.isPlaying) {
                    this.audio.pause();
                    this.isPlaying = false;
                } else {
                    if (this.currentTrackIndex === -1) {
                        this.playTrack(0);
                    } else {
                        this.audio.play();
                        this.isPlaying = true;
                    }
                }

                this.updatePlayButton();
            }

            updatePlayButton() {
                const playIcon = document.getElementById('playIcon');
                const pauseIcon = document.getElementById('pauseIcon');

                if (this.isPlaying) {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'block';
                } else {
                    playIcon.style.display = 'block';
                    pauseIcon.style.display = 'none';
                }
            }

            playNext() {
                if (this.tracks.length === 0) return;

                // Use the predetermined next track index if available, otherwise calculate it
                let nextIndex;
                if (this.nextTrackIndex !== -1 && this.nextTrackIndex < this.tracks.length) {
                    nextIndex = this.nextTrackIndex;
                } else if (this.isShuffle) {
                    nextIndex = Math.floor(Math.random() * this.tracks.length);
                } else {
                    nextIndex = (this.currentTrackIndex + 1) % this.tracks.length;
                }

                this.playTrack(nextIndex);
            }

            playPrevious() {
                if (this.tracks.length === 0) return;

                // If more than 3 seconds played, restart current track
                if (this.audio.currentTime > 3) {
                    this.audio.currentTime = 0;
                    return;
                }

                const prevIndex = (this.currentTrackIndex - 1 + this.tracks.length) % this.tracks.length;
                this.playTrack(prevIndex);
            }

            handleTrackEnd() {
                if (this.isLoop) {
                    this.audio.currentTime = 0;
                    this.audio.play();
                } else {
                    this.playNext();
                }
            }

            toggleShuffle() {
                this.isShuffle = !this.isShuffle;
                document.getElementById('shuffleBtn').classList.toggle('active', this.isShuffle);
                // Update next track display when shuffle is toggled
                if (this.currentTrackIndex !== -1) {
                    this.updateNextUp();
                }
            }

            toggleLoop() {
                this.isLoop = !this.isLoop;
                document.getElementById('loopBtn').classList.toggle('active', this.isLoop);
            }

            toggleTheme() {
                const body = document.body;
                const lightIcon = document.getElementById('lightIcon');
                const darkIcon = document.getElementById('darkIcon');
                
                body.classList.toggle('dark-mode');
                
                if (body.classList.contains('dark-mode')) {
                    lightIcon.style.display = 'none';
                    darkIcon.style.display = 'block';
                    localStorage.setItem('theme', 'dark');
                } else {
                    lightIcon.style.display = 'block';
                    darkIcon.style.display = 'none';
                    localStorage.setItem('theme', 'light');
                }
            }

            updateProgress() {
                const progress = (this.audio.currentTime / this.audio.duration) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
                document.getElementById('currentTime').textContent = this.formatTime(this.audio.currentTime);
            }

            updateDuration() {
                document.getElementById('duration').textContent = this.formatTime(this.audio.duration);
            }

            seek(e) {
                const bar = document.getElementById('progressBar');
                const rect = bar.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const width = rect.width;
                const percentage = Math.max(0, Math.min(1, clickX / width));
                
                this.audio.currentTime = percentage * this.audio.duration;
            }

            formatTime(seconds) {
                if (isNaN(seconds)) return '0:00';
                
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            formatDuration(seconds) {
                if (isNaN(seconds) || seconds === 0) return '—';
                
                const hours = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                
                if (hours > 0) {
                    return `${hours}hr ${mins}min`;
                } else {
                    return `${mins}min`;
                }
            }

            handleKeyboard(e) {
                // Space: play/pause
                if (e.code === 'Space' && e.target === document.body) {
                    e.preventDefault();
                    this.togglePlay();
                }
                // Arrow Left: previous
                else if (e.code === 'ArrowLeft') {
                    this.playPrevious();
                }
                // Arrow Right: next
                else if (e.code === 'ArrowRight') {
                    this.playNext();
                }
                // S: shuffle
                else if (e.code === 'KeyS') {
                    this.toggleShuffle();
                }
                // L: loop
                else if (e.code === 'KeyL') {
                    this.toggleLoop();
                }
            }

            saveSession() {
                try {
                    const session = {
                        volume: this.audio.volume,
                        isShuffle: this.isShuffle,
                        isLoop: this.isLoop
                    };
                    localStorage.setItem('musicPlayerSession', JSON.stringify(session));
                } catch (error) {
                    console.error('Error saving session:', error);
                }
            }

            loadSession() {
                try {
                    const session = localStorage.getItem('musicPlayerSession');
                    if (session) {
                        const data = JSON.parse(session);
                        this.audio.volume = data.volume || 0.7;
                        this.isShuffle = data.isShuffle || false;
                        this.isLoop = data.isLoop || false;
                        
                        // Sync custom volume slider visuals
                        const savedPct = (this.audio.volume * 100);
                        document.getElementById('volumeFill').style.width  = savedPct + '%';
                        document.getElementById('volumeThumb').style.left  = savedPct + '%';
                        document.getElementById('shuffleBtn').classList.toggle('active', this.isShuffle);
                        document.getElementById('loopBtn').classList.toggle('active', this.isLoop);
                    }

                    // Load theme preference
                    const theme = localStorage.getItem('theme');
                    const body = document.body;
                    const lightIcon = document.getElementById('lightIcon');
                    const darkIcon = document.getElementById('darkIcon');
                    
                    if (theme === 'dark') {
                        body.classList.add('dark-mode');
                        lightIcon.style.display = 'none';
                        darkIcon.style.display = 'block';
                    } else {
                        body.classList.remove('dark-mode');
                        lightIcon.style.display = 'block';
                        darkIcon.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error loading session:', error);
                }
            }
        }

        // Initialize player
        const player = new MusicPlayer();
    </script>
</body>
</html>
